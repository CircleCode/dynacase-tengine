#! /bin/rpm
#
#  File: libwhat.spec
#  $Id: freedom-te.spec.in,v 1.2 2008/11/21 16:57:59 jerome Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define cerbere         %(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'none' && echo 1 || echo 0)
%define pld		%(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'PLD' && echo 1 || echo 0)
%define redhat	        %(rpm -q --queryformat '%{VENDOR}' rpm | grep -q -e 'Red Hat, Inc.' -e "Fedora"  && echo 1 || echo 0)
%{?ncerbere:%define cerbere 1}
%{?ncerbere:%define redhat 0}
%{?ncerbere:%define pld 0}
%{?nredhat:%define cerbere 0}
%{?nredhat:%define redhat 1}
%{?nredhat:%define pld 0}
%{?npld:%define cerbere 0}
%{?npld:%define redhat 0}
%{?npld:%define pld 1}
%if %{cerbere}
  %define destdir /usr/share/pear
  %define httpuser http
  %define apacheconfdir /etc/httpd/httpd.conf
  %define releasepostfix %(echo)
%else
  %if %{pld}
    %define destdir /usr/share/pear
    %define httpuser http
    %define apacheconfdir /etc/webapps/what
    %define releasepostfix cb
   %else
      %if %{redhat}
        %define destdir /usr/share/pear
        %define httpuser apache
        %define apacheconfdir /etc/httpd/conf.d
        %define releasepostfix fc%(cat /etc/fedora-release | sed -e 's/.* release \\([[:digit:]]\\+\\) .*/\\1/')
      %else        
        %define destdir /usr/share/pear
        %define httpuser apache
        %define apacheconfdir /etc/httpd/conf.d
        %define releasepostfix unk
      %endif
  %endif
%endif


%{?ndestdir:%define destdir %{ndestdir}}
%{?nhttpuser:%define httpuser %{nhttpuser}}
%{?rpost:%define releasepostfix %{rpost}}

Summary: The Transformation Engine
Name: freedom-te
Version: @VERSION@
License: GPL
Release: @RELEASE@%{releasepostfix}
Group: Applications/Publishing
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
# post-2.2.0 fix (can go away with next release):
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Yannick Le Briquer <yannick.lebriquer@anakeen.com>
BuildArchitectures: noarch
BuildRoot: %{_tmppath}/%{name}-%{version}-root-%(id -u -n)
PreReq: vixie-cron
Requires: php-pgsql
%if %{cerbere} || %{pld}
Requires: php-pcntl >= 5.0
Requires: php-posix
Requires: php-sysvsem
Requires: poppler-progs
%endif
Requires: postgresql >= 7.2
Requires: recode
%if %{pld}
Requires: iconv
%endif
%if %{redhat} 
Requires: glibc-common
Requires: poppler-utils
Requires: xorg-x11-server-Xvfb
Requires: xorg-x11-xauth
%endif
Requires: ghostscript
Requires: openoffice.org-writer
Provides: TE = @VERSION@
%description
The Transformation engine allow to convert file in different other format in asynchronous mode.


%package client
Summary: The Transformation libraries functions
Group: Applications/Publishing
Provides: TE-CLIENT = @VERSION@
%if %{cerbere} || %{pld}
Requires: php-common >= 5.0
%else
Requires: php >= 5.0
%endif

%description client
The freedom-te client provide php class to communicate with transformation server


%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
%if  %{pld}
   ./configure  --with-pubrule=`pwd` \
               --with-tedinit=ted.pld \
	     --prefix=%{destdir}
%else
   ./configure  --with-pubrule=`pwd` \
	     --prefix=%{destdir}
%endif
make  pubdir=$RPM_BUILD_ROOT%{destdir}

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post 


%preun


%post client


%preun client


%files
%dir %{destdir}/TE
%dir /etc/te.d
%dir /etc/rc.d/init.d
%attr(755,root,root) /etc/rc.d/init.d/ted
%attr(700,root,root) /etc/cron.d/TE.cron
%attr(600,root,root) %config(noreplace) /etc/te.conf
%attr(644,root,root) %config(noreplace) /etc/te.d/env
%{destdir}/TE/Class.Engine.php
%{destdir}/TE/Class.Histo.php
%{destdir}/TE/Class.PgObj.php
%{destdir}/TE/Class.QueryPg.php
%{destdir}/TE/Class.TERendering.php
%{destdir}/TE/Class.TEServer.php
%{destdir}/TE/Class.Task.php
%{destdir}/TE/Lib.TEUtil.php
%{destdir}/TE/engine_init.sql
%{destdir}/TE/engines
%{destdir}/TE/te_init.php
%{destdir}/TE/te_rendering_server
%{destdir}/TE/te_rendering_server.php
%{destdir}/TE/te_request_server
%{destdir}/TE/te_request_server.php
%{destdir}/TE/te_server_init
%{destdir}/TE/te_server_init.php
%{destdir}/TE/te_clean




%files client
%dir %{destdir}/TE
%{destdir}/TE/Class.TEClient.php
%{destdir}/TE/Lib.TEUtil.php



%changelog
* Tue Oct 30 2000 Yannick Le Briquer <yannick.lebriquer@anakeen.com>
- Build first RPM

